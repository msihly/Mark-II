import { app, BrowserWindow, Menu, nativeImage, Tray } from "electron";
import path from "path";
import { readFile } from "fs/promises";
import { logToFile } from "./utils";

const baseUrl = !app.isPackaged
  ? `http://localhost:3737`
  : `file://${path.join(__dirname, "..", "index.html")}`;

/* ------------------------------- MAIN WINDOW ------------------------------ */
let mainWindow = null;

const createMainWindow = async () => {
  logToFile("debug", "Loading servers...");

  const serverUrl = app.isPackaged
    ? path.resolve(process.resourcesPath, "extraResources/server.mjs")
    : path.join(__dirname, "../extraResources/server.mjs");

  /** Using eval is the only method that works with packaged executable for indeterminable reason. */
  eval(await readFile(serverUrl, { encoding: "utf8" }));

  mainWindow = new BrowserWindow({
    autoHideMenuBar: true,
    backgroundColor: "#111",
    webPreferences: { contextIsolation: false, nodeIntegration: true, webSecurity: false },
  });

  const remoteMain = await import("@electron/remote/main");
  remoteMain.initialize();
  remoteMain.enable(mainWindow.webContents);

  logToFile("debug", "Loading main window...");
  await mainWindow.loadURL(baseUrl);
  logToFile("debug", "Main window loaded.");

  if (!app.isPackaged) mainWindow.webContents.openDevTools({ mode: "bottom" });

  mainWindow.on("close", (event) => {
    event.preventDefault();
    mainWindow.hide();
  });
};

app.whenReady().then(async () => {
  // if (!app.isPackaged) {
  //   const {
  //     default: installExtension,
  //     REACT_DEVELOPER_TOOLS,
  //     REDUX_DEVTOOLS,
  //   } = require("electron-devtools-installer");

  //   await installExtension([REACT_DEVELOPER_TOOLS, REDUX_DEVTOOLS]).catch((err) =>
  //     logToFile("error", "Error loading extensions:", err)
  //   );
  // }

  try {
    createMainWindow();

    const icon = nativeImage.createFromDataURL(
      "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAACXBIWXMAAAjrAAAI6wEWkMgdAAAE7mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4xLWMwMDAgNzkuYjBmOGJlOSwgMjAyMS8xMi8wOC0xOToxMToyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIzLjIgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMi0xMi0xMVQyMjo0NDozMi0wNTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjItMTItMTFUMjI6NTE6NDctMDU6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMTItMTFUMjI6NTE6NDctMDU6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjg1NzkxNjFmLTk2NDktZmM0ZS1iYWRiLTQ1NzRiYWRjN2VhZCIgeG1wTU06RG9jdW1lbnRJRD0i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"
    );

    const tray = new Tray(icon);
    tray.setToolTip("Mark II");

    const contextMenu = Menu.buildFromTemplate([
      {
        label: "Quit",
        click: () => {
          mainWindow?.destroy?.();
          app.quit();
        },
      },
    ]);
    tray.setContextMenu(contextMenu);

    tray.on("click", () => {
      if (mainWindow && !mainWindow.isVisible()) mainWindow.show();
    });
  } catch (err) {
    logToFile("error", err);
  }
});
